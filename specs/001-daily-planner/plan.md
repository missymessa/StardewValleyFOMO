# Implementation Plan: Daily Planner — Stardew Valley FOMO Mod

**Branch**: `001-daily-planner` | **Date**: 2026-02-15 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/001-daily-planner/spec.md`

## Summary

A SMAPI mod that provides an in-game daily planner panel showing the player what collectibles (fish, forageables, artifacts, minerals, cooking/crafting recipes, shippable items) are available today based on season, weather, and time; highlights items needed for Community Center bundles; shows NPC birthday reminders with gift suggestions; previews tomorrow's opportunities; and alerts when season-exclusive items are about to become unavailable. The mod is a read-only information overlay that does not modify game state.

## Technical Context

**Language/Version**: C# targeting .NET 6.0 (required by Stardew Valley / SMAPI)
**Primary Dependencies**: SMAPI (Stardew Modding API), Pathoschild.Stardew.ModBuildConfig NuGet package, StardewValley game assemblies (reference only)
**Storage**: N/A — read-only from game state; mod config via SMAPI's `IModHelper.ReadConfig<T>()`
**Testing**: xUnit, with Moq for interface mocking; tests reference only the core library, never game DLLs
**Target Platform**: Windows / Linux / macOS (crossplatform via SMAPI)
**Project Type**: Single mod project with game-decoupled core library and thin SMAPI adapter
**Performance Goals**: Panel opens in under 1 second; no visible FPS impact during gameplay
**Constraints**: All core logic must be testable without game assemblies (Constitution Principle I); TDD mandatory (Constitution Principle II)
**Scale/Scope**: Single-player mod; data volume limited to one player's save state

## Constitution Check

*GATE: Must pass before implementation. Re-check after design.*

| Principle | Status | How Addressed |
|-----------|--------|---------------|
| I. Game-Decoupled Core | ✅ Pass | Core logic in `StardewFOMO.Core` with interfaces (`IGameStateProvider`, `IBundleRepository`, etc.); no direct game type references |
| II. Test-First | ✅ Pass | TDD mandated; test project references only Core; tests run without game assemblies |
| III. Thin SMAPI Layer | ✅ Pass | `ModEntry` wires interfaces to game implementations and forwards SMAPI events; no business logic in adapter |
| IV. Observability | ✅ Pass | Core services accept `ILogger` interface; SMAPI adapter implements via `IMonitor`; structured log messages with context |
| V. Simplicity & YAGNI | ✅ Pass | Two projects only (Core + Mod); no speculative abstractions; no third-party NuGet beyond SMAPI build config |

## Project Structure

### Documentation (this feature)

```text
specs/001-daily-planner/
├── plan.md              # This file
├── spec.md              # Feature specification
├── research.md          # SMAPI API research (not yet created)
├── data-model.md        # Entity details (not yet created)
├── quickstart.md        # Manual test scenarios (not yet created)
└── tasks.md             # Task breakdown (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
StardewFOMO.sln                          # Solution file at repo root
src/
├── StardewFOMO.Core/                    # Game-decoupled core library
│   ├── StardewFOMO.Core.csproj
│   ├── Interfaces/
│   │   ├── IGameStateProvider.cs        # Abstracts game date, season, weather, time
│   │   ├── IBundleRepository.cs         # Abstracts Community Center bundle state
│   │   ├── ICollectionRepository.cs     # Abstracts fish/forage/ship/museum/cook/craft collections
│   │   ├── IInventoryProvider.cs        # Abstracts player inventory and storage
│   │   ├── INpcRepository.cs            # Abstracts NPC birthday and gift preference data
│   │   ├── IFishRepository.cs           # Abstracts fish availability data
│   │   ├── IForageRepository.cs         # Abstracts forage availability data
│   │   ├── IRecipeRepository.cs         # Abstracts cooking/crafting recipe data
│   │   └── ILogger.cs                   # Logging abstraction
│   ├── Models/
│   │   ├── GameDate.cs                  # Season, day, year, weather
│   │   ├── CollectibleItem.cs           # Fish/forage/artifact/mineral/recipe with availability
│   │   ├── BundleInfo.cs                # Bundle name, required items, completion state
│   │   ├── NpcBirthday.cs              # NPC name, date, loved/liked gifts
│   │   ├── TomorrowPreview.cs           # Weather forecast, new collectibles, events
│   │   ├── DailySummary.cs              # Compiled planner data for one day
│   │   └── CollectionStatus.cs          # Enum: NotCollected, InInventory, EverCollected
│   └── Services/
│       ├── DailySummaryService.cs       # Orchestrates building the full daily summary
│       ├── FishAvailabilityService.cs   # Determines which fish are available today
│       ├── ForageAvailabilityService.cs # Determines which forageables are available today
│       ├── BundleTrackingService.cs     # Maps available items to incomplete bundles
│       ├── CollectionTrackingService.cs # Tracks shipping/museum/cooking/crafting completion
│       ├── BirthdayService.cs           # Finds today's + upcoming NPC birthdays
│       ├── TomorrowPreviewService.cs    # Builds tomorrow's preview
│       └── SeasonAlertService.cs        # Generates last-chance season alerts
│
└── StardewFOMO.Mod/                     # Thin SMAPI adapter
    ├── StardewFOMO.Mod.csproj
    ├── manifest.json                    # SMAPI mod manifest
    ├── ModEntry.cs                      # SMAPI entry point (thin adapter)
    ├── ModConfig.cs                     # Configuration POCO (hotkey, lookahead days, etc.)
    ├── Adapters/
    │   ├── GameStateAdapter.cs          # Implements IGameStateProvider from game state
    │   ├── BundleAdapter.cs             # Implements IBundleRepository from game data
    │   ├── CollectionAdapter.cs         # Implements ICollectionRepository from game data
    │   ├── InventoryAdapter.cs          # Implements IInventoryProvider from game data
    │   ├── NpcAdapter.cs                # Implements INpcRepository from game data
    │   ├── FishDataAdapter.cs           # Implements IFishRepository from game data
    │   ├── ForageDataAdapter.cs         # Implements IForageRepository from game data
    │   ├── RecipeDataAdapter.cs         # Implements IRecipeRepository from game data
    │   └── SmapiLoggerAdapter.cs        # Implements ILogger via IMonitor
    └── UI/
        └── PlannerOverlay.cs            # In-game panel rendering (MonoGame/SpriteBatch)

tests/
└── StardewFOMO.Core.Tests/             # Unit tests — NO game assembly references
    ├── StardewFOMO.Core.Tests.csproj
    ├── Fakes/                           # Shared test doubles for interfaces
    │   ├── FakeGameStateProvider.cs
    │   ├── FakeBundleRepository.cs
    │   ├── FakeCollectionRepository.cs
    │   ├── FakeInventoryProvider.cs
    │   ├── FakeNpcRepository.cs
    │   ├── FakeFishRepository.cs
    │   ├── FakeForageRepository.cs
    │   ├── FakeRecipeRepository.cs
    │   └── TestLogger.cs
    └── Services/
        ├── FishAvailabilityServiceTests.cs
        ├── ForageAvailabilityServiceTests.cs
        ├── BundleTrackingServiceTests.cs
        ├── CollectionTrackingServiceTests.cs
        ├── BirthdayServiceTests.cs
        ├── TomorrowPreviewServiceTests.cs
        ├── SeasonAlertServiceTests.cs
        └── DailySummaryServiceTests.cs
```

**Structure Decision**: Two-project solution (Core + Mod) following Constitution Principle I (Game-Decoupled Core). Core has zero game references and is fully unit-testable. Mod is the thin SMAPI adapter that implements Core interfaces using game types. Test project references only Core.

## Complexity Tracking

> No constitution violations — no entries needed.

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| (none)    | —          | —                                   |
